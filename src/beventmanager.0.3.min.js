/*
    BEventManager - Javascript Custom Event Manager
    version 0.3
    31.05.2013
    http://btools.eu
    https://github.com/BTooLs/BEventManager/
 */
(function(e){function s(e){if(!e||!e.event||typeof t[e.event]!="undefined"){return false}e=c({},{event:false,triggersLeft:false,before:[],on:[],after:[],cascadeEvent:false},e);if(e.cascadeEvent&&typeof t[e.cascadeEvent]=="undefined"){if(i){s({event:e.cascadeEvent})}else{r&&l("err: cascadeEvent not defined",e.cascadeEvent);return false}}t[e.event]=e;return true}function o(e){t[e]=undefined;try{delete t[e]}catch(n){}for(var r in t){if(t[r].cascadeEvent===e){t[r].cascadeEvent=false}}}function u(e,o){e=c({},{event:false,callId:false,callback:false,thisArg:window,argsArray:[],triggersLeft:false,queueEnd:true},e);if(typeof t[e.event]=="undefined"){if(i){s({event:e.event})}else{r&&l("err: event not defined at listener create",e.event);return false}}if(!e.event||typeof e.callback!="function"){r&&l("err: listener/callback not a function",e);return false}if(typeof e.callId==="string"){var u=t[e.event][o].length;for(var a=0;a<u;a++){if(t[e.event][o][a].callId==e.callId){r&&l("err: callId already used for this event/type");return false}}}else{e.callId=n++}if(e.queueEnd){t[e.event][o].push(e)}else{t[e.event][o].unshift(e)}return e.callId}function a(e,n,i){if(t[e]==undefined){r&&l("err: event not exists");return false}r&&l("undefining",e,n,i);var s=t[e][n].length;for(var o=0;o<s;o++){if(t[e][n][o].callId==i){t[e][n].splice(o,1);break}}return true}function f(e,n){r&&l("dispatching ",e,n);var i=t[e][n].length;for(var s=0;s<i;s++){var o=t[e][n][s];r&&l("calling listener",o.callId);o.callback.call(o.thisArg,o.argsArray);if(typeof o.triggersLeft==="number"){if(--o.triggersLeft<=0){a(e,n,o.callId)}}}}function l(){if(!console||!typeof console.log=="function")return false;var e=["EventMgr:"].concat(Array.prototype.slice.call(arguments));console.log.apply(this,e);return true}function c(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=false;if(typeof o==="boolean"){f=o;o=arguments[1]||{};u=2}if(typeof o!=="object"&&!jQuery.isFunction(o)){o={}}if(a===u){o=this;--u}for(;u<a;u++){if((i=arguments[u])!=null){for(r in i){e=o[r];n=i[r];if(o===n){continue}if(f&&n&&(jQuery.isPlainObject(n)||(t=jQuery.isArray(n)))){if(t){t=false;s=e&&jQuery.isArray(e)?e:[]}else{s=e&&jQuery.isPlainObject(e)?e:{}}o[r]=jQuery.extend(f,s,n)}else if(n!==undefined){o[r]=n}}}}return o}var t={};var n=0;var r=false;var i=true;this.define=function(){var e=false;for(var t=0;t<arguments.length;t++){var n=arguments[t];if(typeof n=="undefined"||typeof n.event!=="string"){r&&l("err: event name missing");e=false;continue}var i={event:n.event};if(typeof n.triggersLeft=="number"&&n.triggersLeft>0||n.triggersLeft===false){i.triggersLeft=n.triggersLeft}if(typeof n.cascadeEvent=="string"||n.cascadeEvent===false){i.cascadeEvent=n.cascadeEvent}e=s(i)}return e};this.eventIsDefined=function(e){return typeof t[e]!=="undefined"};this.undefine=function(e){return o(e)};this.on=function(){if(arguments.length==1){var e=arguments[0]}else if(arguments.length==2){var e={event:arguments[0],callback:arguments[1]}}else{r&&l("err: wrong number of parameters (on)");return false}return u(e,"on")};this.before=function(e){if(arguments.length==1){var e=arguments[0]}else if(arguments.length==2){var e={event:arguments[0],callback:arguments[1]}}else{r&&l("err: wrong number of parameters (on)");return false}return u(e,"before")};this.after=function(e){if(arguments.length==1){var e=arguments[0]}else if(arguments.length==2){var e={event:arguments[0],callback:arguments[1]}}else{r&&l("err: wrong number of parameters (on)");return false}return u(e,"after")};this.unlisten=function(e,t,n){if(e&&t&&(t==="on"||t=="before"||t=="after")&&typeof n!="undefined"){return a(e,t,n)}r&&l("err: wrong parameters");return false};this.dispatch=function(e){if(typeof t[e]=="undefined"){r&&l("err: trigger event not exists",e);return false}r&&l("dispatching ",e);t[e].before.length&&f(e,"before");t[e].on.length&&f(e,"on");t[e].after.length&&f(e,"after");if(t[e].cascadeEvent){this.dispatch(t[e].cascadeEvent)}if(typeof t[e].triggersLeft==="number"&&--t[e].triggersLeft<=0){o(e)}return true};this.eventLooseMode=function(e){i=e};this.eventDebugMode=function(e){r=e};this.eventDebug=function(){return t};this.eventDestroy=function(){t={};n=0};return e.eventMgr=this})(window);
